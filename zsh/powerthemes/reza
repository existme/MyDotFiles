# vim: set filetype=zsh :

# Turn on for Debugging
# PS4='%s%f%b%k%F{blue}%{λ%}%L %F{240}%N:%i%(?.. %F{red}%?) %1(_.%F{yellow}%-1_ .)%s%f%b%k	'
# zstyle ':vcs_info:*+*:*' debug true
# set -o xtrace



POWERLEVEL9K_MODE='nerdfont-complete'
# Possible values: 
# - truncate_with_package_name      git MyD…les zsh com…ion plu…ins fzf src algo 
# - truncate_with_folder_marker     it uses POWERLEVEL9K_SHORTEN_FOLDER_MARKER 
# - truncate_middle                 git MyD… zsh com… plu… fzf src algo
# - truncate_from_right             g… M… z… c… p… f… s… algo  (DIR_LENGTH=1)
# - truncate_to_unique              h e gi My z c p f sr a
# - Default                         Truncate from left:  fzf src algo 
# POWERLEVEL9K_SHORTEN_FOLDER_MARKER="$HOME/git/MyDotFiles/zsh"
POWERLEVEL9K_SHORTEN_STRATEGY=truncate_with_package_name
# How many characters will be untouched is controlled by 
POWERLEVEL9K_SHORTEN_DIR_LENGTH=3
POWERLEVEL9K_DIR_OMIT_FIRST_CHARACTER=false
POWERLEVEL9K_SHORTEN_DELIMITER="…"
# POWERLEVEL9K_SHORTEN_DIR_LENGTH=3

POWERLEVEL9K_DIR_HOME_FOREGROUND="white"
POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND="white"
POWERLEVEL9K_DIR_DEFAULT_FOREGROUND="white"

POWERLEVEL9K_DIR_HOME_FOREGROUND="231"
POWERLEVEL9K_DIR_HOME_BACKGROUND="239"
POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND="231" #253
POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND="239"
POWERLEVEL9K_DIR_PATH_SEPARATOR="%F{247} ⠶ %F{231}"
# POWERLEVEL9K_DIR_PATH_SEPARATOR="%F{242}  %F{253}"
# POWERLEVEL9K_DIR_ICON='  '
POWERLEVEL9K_HOME_SUB_ICON=' '

POWERLEVEL9K_DIR_DEFAULT_FOREGROUND="253"
POWERLEVEL9K_DIR_DEFAULT_BACKGROUND="239"
POWERLEVEL9K_FOLDER_ICON=' '

POWERLEVEL9K_DIR_WRITABLE_FORBIDDEN_FOREGROUND="124"
POWERLEVEL9K_DIR_WRITABLE_FORBIDDEN_BACKGROUND="220"

# POWERLEVEL9K_LEFT_SEGMENT_SEPARATOR=$''


POWERLEVEL9K_PROMPT_ON_NEWLINE=false
POWERLEVEL9K_PROMPT_ADD_NEWLINE=true
POWERLEVEL9K_RPROMPT_ON_NEWLINE=false

POWERLEVEL9K_TIME_BACKGROUND="238"
POWERLEVEL9K_TIME_FOREGROUND="230"
POWERLEVEL9K_TIME_VISUAL_IDENTIFIER_COLOR="red"
POWERLEVEL9K_TIME_FORMAT=" %D{%H:%M   %d.%m.%y}"

POWERLEVEL9K_COMMAND_EXECUTION_TIME_BACKGROUND='black'
POWERLEVEL9K_COMMAND_EXECUTION_TIME_FOREGROUND='blue'

POWERLEVEL9K_OS_ICON_BACKGROUND="096"
POWERLEVEL9K_OS_ICON_FOREGROUND="251"
POWERLEVEL9K_OS_LEFT_SEGMENT_SEPARATOR="X"
POWERLEVEL9K_LINUX_ICON=''
POWERLEVEL9K_RAM_ICON=''
POWERLEVEL9K_LOAD_ICON=''


POWERLEVEL9K_STATUS_VERBOSE=false
POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(os_icon root_indicator context dir dir_writable vcs)
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(command_execution_time status ram load time)

# S4='%s%f%b%k%F{blue}%{λ%}%L %F{240}%N:%i%(?.. %F{red}%?) %1(_.%F{yellow}%-1_ .)%s%f%b%k	'
# zstyle ':vcs_info:*+*:*' debug true
# set -o xtrace

POWERLEVEL9K_VCS_UNTRACKED_ICON='\b'   #┈
POWERLEVEL9K_VCS_UNTRACKED_ICON='\b'     #┈
POWERLEVEL9K_VCS_INCOMING_CHANGES_ICON=' '
POWERLEVEL9K_VCS_OUTGOING_CHANGES_ICON=' '
# POWERLEVEL9K_VCS_INCOMING_CHANGES_ICON=' '
# POWERLEVEL9K_VCS_OUTGOING_CHANGES_ICON=' '
# POWERLEVEL9K_VCS_COMMIT_ICON="\uf417"
POWERLEVEL9K_VCS_UNSTAGED_ICON='%F{0} %F{0}'
POWERLEVEL9K_VCS_STAGED_ICON='%F{0}%F{0}'
POWERLEVEL9K_VCS_STASH_ICON=" "

POWERLEVEL9K_VCS_GIT_GITHUB_ICON=""
POWERLEVEL9K_VCS_GIT_BITBUCKET_ICON="  "
POWERLEVEL9K_VCS_GIT_GITLAB_ICON="  "
POWERLEVEL9K_VCS_GIT_ICON="  "
POWERLEVEL9K_VCS_BRANCH_ICON="  "
POWERLEVEL9K_VCS_CLEAN_FOREGROUND='black'
POWERLEVEL9K_VCS_CLEAN_BACKGROUND='green'
POWERLEVEL9K_VCS_UNTRACKED_FOREGROUND='black'
POWERLEVEL9K_VCS_UNTRACKED_BACKGROUND='yellow'
POWERLEVEL9K_VCS_MODIFIED_FOREGROUND='black'
POWERLEVEL9K_VCS_MODIFIED_BACKGROUND='yellow'

unset POWERLEVEL9K_SHOW_CHANGESET
unset POWERLEVEL9K_CHANGESET_HASH_LENGTH
# plugins=(git git-extras gem bundler osx ruby rvm rails sudo sublime colorize history history-substring-search last-working-dir compleat zsh-completions zsh-history-substring-search zsh-autosuggestions zsh-syntax-highlighting zsh-syntax-highlighting-filetypes warhol)
# source $ZSH/oh-my-zsh.sh
source $SCRIPTPATH/zsh/bundle/powerlevel9k/powerlevel9k.zsh-theme


#Fix ram problem due to grep alias
function prompt_ram() {
  local base=''
  local ramfree=0
  if [[ "$OS" == "OSX" ]]; then
    # Available = Free + Inactive
    # See https://support.apple.com/en-us/HT201538
    ramfree=$(vm_stat | /bin/grep "Pages free" | /bin/grep -o -E '[0-9]+')
    ramfree=$((ramfree + $(vm_stat | grep "Pages inactive" | /bin/grep -o -E '[0-9]+')))
    # Convert pages into Bytes
    ramfree=$(( ramfree * 4096 ))
  else
    if [[ "$OS" == "BSD" ]]; then
      ramfree=$(/bin/grep 'avail memory' /var/run/dmesg.boot | awk '{print $4}')
    else
      ramfree=$(/bin/grep -o -E "MemAvailable:\s+[0-9]+" /proc/meminfo | /bin/grep -o "[0-9]*")
      base='K'
    fi
  fi
  "$1_prompt_segment" "$0" "$2" "yellow" "$DEFAULT_COLOR" "$(printSizeHumanReadable "$ramfree" $base)" 'RAM_ICON'
}
